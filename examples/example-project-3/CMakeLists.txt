# This file was generated by Xen ProjGen.
# File: CMakeLists.txt
# Version: 1.0
# Author: XeniaPhe
# License: MIT License
# Github: https://github.com/XeniaPhe/Xen-ProjGen
# Description: Configures the build system for the project, defining targets, dependencies and settings

cmake_minimum_required(VERSION 3.15...3.30)
include("${CMAKE_SOURCE_DIR}/project/utils/functions.cmake")

project(example-project-3 VERSION 0.1.0 LANGUAGES CXX)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

set(TARGET "example-project-3")

# Make a list of useful preprocessor definitions to add to the build
set(DEFS "")
get_compiler_definition(COMPILER_DEFINITION)
get_compiler_variant(${COMPILER_DEFINITION} COMPILER_VARIANT)
list(APPEND DEFS "${COMPILER_DEFINITION}")
append_architectural_definitions(DEFS)
append_os_definitions(DEFS)
append_build_definitions(DEFS)

# Also add the user defined definitions to the list
read_file("${CMAKE_SOURCE_DIR}/project/config/definitions.txt" USER_DEFS)
list(APPEND DEFS "${USER_DEFS}")

# Get the compiler flags for the target compiler
get_compiler_flags(${COMPILER_VARIANT} FLAGS)

# Get the compiler features
read_file("${CMAKE_SOURCE_DIR}/project/config/compiler_features.txt" FEATURES)

# Get the link options
read_file("${CMAKE_SOURCE_DIR}/project/config/linker_flags.txt" LINKER_FLAGS)

file(GLOB LINK_LIBS "${CMAKE_SOURCE_DIR}/libs/*/lib/*.a" "${CMAKE_SOURCE_DIR}/libs/*/lib/*.lib")
file(GLOB DY_LIBS "${CMAKE_SOURCE_DIR}/libs/*/lib/*.so" "${CMAKE_SOURCE_DIR}/libs/*/lib/*.dll" "${CMAKE_SOURCE_DIR}/libs/*/lib/*.dylib")
file(GLOB INCLUDE_DIRS "${CMAKE_SOURCE_DIR}/libs/*/include")
file(GLOB_RECURSE HEADERS "${CMAKE_SOURCE_DIR}/src/*.hpp")
file(GLOB_RECURSE SOURCE "${CMAKE_SOURCE_DIR}/src/*.cpp")
file(GLOB_RECURSE TESTS "${CMAKE_SOURCE_DIR}/test/*.cpp")

add_lib_target("${TARGET}" "${SOURCE}" "${HEADERS}" "${INCLUDE_DIRS}" "${LINK_LIBS}" "${DY_LIBS}" "${DEFS}" "${FLAGS}" "${FEATURES}" "${LINKER_FLAGS}" FALSE)
add_exec_target("tests" "${TESTS}" "${HEADERS}" "${INCLUDE_DIRS}" "${LINK_LIBS}" "${DY_LIBS}" "${DEFS}" "${FLAGS}" "${FEATURES}" "${LINKER_FLAGS}" TRUE)

enable_testing()
add_test(NAME "tests" COMMAND "tests")